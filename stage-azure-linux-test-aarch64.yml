  jobs:
  - job: 'arm64'
    variables:
      REPO_DIR: "scikit-learn"
      PLAT: "aarch64"
      NP_BUILD_DEP: "numpy==1.13.3"
      CYTHON_BUILD_DEP: "cython==0.29.14"
      SCIPY_BUILD_DEP: "scipy"
      JOBLIB_BUILD_DEP: "joblib==0.11"
      NIGHTLY_BUILD_COMMIT: "master"
      NIGHTLY_BUILD: "false"
      TEST_DEPENDS: "pytest"
      JUNITXML: "test-data.xml"
      TEST_DIR: "tmp_for_test"
    strategy:
      matrix:
        py_3.6_64:
          MB_PYTHON_VERSION: '3.6'
          no_extensions: ''
          image: 'ubuntu-latest'
        py_3.7_64:
          MB_PYTHON_VERSION: '3.7'
          no_extensions: ''
          image: 'ubuntu-latest'
        py_3.8_64:
          MB_PYTHON_VERSION: '3.8'
          no_extensions: ''
          image: 'ubuntu-latest'
    pool:
      vmImage: 'ubuntu-latest'

    steps:
    - checkout: self
      submodules: true
      clean: true
      
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '$(MB_PYTHON_VERSION)'
        architecture: 'x64'
        displayName: Set python version

    - script: docker run --rm --privileged hypriot/qemu-register
      displayName: 'Regietering qemu'
    - script: |
        set -xeo pipefail
        export SCIKITLEARN_ROOT=`pwd`
        echo $SCIKITLEARN_ROOT
        sudo bash $SCIKITLEARN_ROOT/azure/build_steps.sh "$(MB_PYTHON_VERSION)"
      displayName: 'Running AArch64 build'
